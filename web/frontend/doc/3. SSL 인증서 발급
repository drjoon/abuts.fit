1. AWS Certificate Manager (ACM) SSL ì¸ì¦ì„œ ë°œê¸‰ (DNS ì¸ì¦)
1-1. ì¸ì¦ì„œ ìš”ì²­
aws acm request-certificate \
  --domain-name abuts.fit \
  --validation-method DNS \
  --subject-alternative-names www.abuts.fit \
  --region us-east-1
âœ… ë°˜ë“œì‹œ --region us-east-1 (ë²„ì§€ë‹ˆì•„ ë¶ë¶€) ë¡œ í•´ì•¼ í•©ë‹ˆë‹¤. CloudFrontëŠ” ì „ì„¸ê³„ ê³µí†µ ë¦¬ì „ì´ê¸° ë•Œë¬¸ì…ë‹ˆë‹¤.

1-2. ì¸ì¦ì„œ ARN ê¸°ë¡í•´ë‘ê¸°
ì¶œë ¥ëœ ê²°ê³¼ì— "CertificateArn": "arn:aws:acm:..." í˜•íƒœê°€ ë‚˜ì™€ìš”.
â†’ ì´ê±¸ ë©”ëª¨í•´ë‘¬ì•¼ í•©ë‹ˆë‹¤.

"CertificateArn": "arn:aws:acm:us-east-1:106055905364:certificate/1d56708e-e803-4b78-87e1-b0546b2380fc"

1-3. ì¸ì¦ì— í•„ìš”í•œ CNAME ê°’ ê°€ì ¸ì˜¤ê¸°
aws acm describe-certificate \
  --certificate-arn "arn:aws:acm:us-east-1:106055905364:certificate/1d56708e-e803-4b78-87e1-b0546b2380fc" \
  --region us-east-1
ì¶œë ¥ ì¤‘ DomainValidationOptions ì•ˆì— ResourceRecord í•­ëª©ì´ ë‚˜ì˜µë‹ˆë‹¤:

1-4. Route 53ì— CNAME ë ˆì½”ë“œ ë“±ë¡ (DNS ì¸ì¦)
aws route53 change-resource-record-sets \
  --hosted-zone-id Z0070040387JJQBR7DLBD \
  --change-batch file://doc/validate-certificate.json

validate-certificate.json ì˜ˆì‹œ

{
  "Comment": "Add CNAME to validate ACM certificate",
  "Changes": [
    {
      "Action": "UPSERT",
      "ResourceRecordSet": {
        "Name": "_57e4e788b3ede66b0f4e591414017745.abuts.fit.",
        "Type": "CNAME",
        "ResourceRecords": [
          {
            "Value": "_96d87169bf3348f975c7b191a6b0b0ec.xlfgrmvvlj.acm-validations.aws."
          }
        ]
      }
    },
    {
      "Action": "UPSERT",
      "ResourceRecordSet": {
        "Name": "_a849223ea41ff85321619961c60af0e9.www.abuts.fit.",
        "Type": "CNAME",
        "ResourceRecords": [
          {
            "Value": "_03cf30bbbd124321309f0325e6a16056.xlfgrmvvlj.acm-validations.aws."
          }
        ]
      }
    }
  ]
}
âœ… Name, ValueëŠ” describe-certificate ì¶œë ¥ê°’ì— ë§ê²Œ ë°”ê¿”ì£¼ì„¸ìš”!

1-5. ì¸ì¦ì„œ ìƒíƒœ í™•ì¸
aws acm describe-certificate \
  --certificate-arn "arn:aws:acm:us-east-1:106055905364:certificate/1d56708e-e803-4b78-87e1-b0546b2380fc" \
  --region us-east-1
"Status": "ISSUED" ë˜ë©´ ì™„ë£Œ.

2. CloudFront ë°°í¬ ìƒì„±
2-1. ê¸°ë³¸ ì„¤ì • íŒŒì¼ ì‘ì„± (ex: create-distribution.json)
{
  "CallerReference": "abuts-fit-$(date +%s)",
  "Aliases": {
    "Quantity": 1,
    "Items": ["abuts.fit"]
  },
  "DefaultRootObject": "index.html",
  "Origins": {
    "Quantity": 1,
    "Items": [
      {
        "Id": "S3-abuts-fit",
        "DomainName": "abuts.fit.s3-website.ap-south-1.amazonaws.com",
        "CustomOriginConfig": {
          "HTTPPort": 80,
          "HTTPSPort": 443,
          "OriginProtocolPolicy": "http-only"
        }
      }
    ]
  },
  "DefaultCacheBehavior": {
    "TargetOriginId": "S3-abuts-fit",
    "ViewerProtocolPolicy": "redirect-to-https",
    "TrustedSigners": {
      "Enabled": false,
      "Quantity": 0
    },
    "ForwardedValues": {
      "QueryString": false,
      "Cookies": {
        "Forward": "none"
      }
    }
  },
  "ViewerCertificate": {
    "ACMCertificateArn": "arn:aws:acm:us-east-1:106055905364:certificate/1d56708e-e803-4b78-87e1-b0546b2380fc",
    "SSLSupportMethod": "sni-only",
    "MinimumProtocolVersion": "TLSv1.2_2021"
  },
  "Enabled": true
}
âœ… [CertificateArn] ì€ ì•ì—ì„œ ë°œê¸‰í•œ ì¸ì¦ì„œ ARNìœ¼ë¡œ êµì²´!

2-2. CloudFront ë°°í¬ ìƒì„± ëª…ë ¹ì–´
aws cloudfront create-distribution \
  --distribution-config file://doc/create-distribution.json
ê²°ê³¼ì— DomainName (ì˜ˆ: d1234abcd.cloudfront.net) ë‚˜ì˜µë‹ˆë‹¤. ê¸°ë¡!
"DomainName": "d3nxonwfndkuq9.cloudfront.net",

3. Route 53 A ë ˆì½”ë“œ ì—°ê²°
3-1. Route 53 A ë ˆì½”ë“œ ìˆ˜ì •
aws route53 change-resource-record-sets \
  --hosted-zone-id Z0070040387JJQBR7DLBD \
  --change-batch file://doc/update-a-record.json
update-a-record.json ì˜ˆì‹œ

{
  "Comment": "Alias abuts.fit to CloudFront",
  "Changes": [
    {
      "Action": "UPSERT",
      "ResourceRecordSet": {
        "Name": "abuts.fit",
        "Type": "A",
        "AliasTarget": {
          "HostedZoneId": "Z11RGJOFQNVJUP",
          "DNSName": "d3nxonwfndkuq9.cloudfront.net.",
          "EvaluateTargetHealth": false
        }
      }
    }
  ]
}
Z2FDTNDATAQYW2 : CloudFront ê³ ì • HostedZoneId (í•­ìƒ ì´ê±°!)

DNSName : CloudFront ìƒì„±ì‹œ ë‚˜ì˜¨ ë„ë©”ì¸.

ğŸ“ ì „ì²´ íë¦„ ì •ë¦¬
ACM ë°œê¸‰ â†’ DNS ì¸ì¦ (Route53)

CloudFront ë°°í¬ ìƒì„± â†’ S3 ì—°ê²°

Route53 A ë ˆì½”ë“œ CloudFrontë¡œ ì—°ê²°

ë!

ğŸ”¥ ì£¼ì˜í•  ì 
CloudFront ìƒì„±/ë°°í¬ì— 10~30ë¶„ ì •ë„ ê±¸ë¦´ ìˆ˜ ìˆì–´ìš”.

CloudFront Distribution í™œì„±í™” ì™„ë£Œë˜ë©´ ë°”ë¡œ HTTPS ì ‘ì† ê°€ëŠ¥!


S3 + CloudFront ë°°í¬ í™˜ê²½ì—ì„œ ì½”ë“œ ë°°í¬ í›„ **CloudFront ìºì‹œ ë¬´íš¨í™”(invalidation)**ë¥¼ í•´ì£¼ë©´,
ìµœì‹  íŒŒì¼ì´ ì¦‰ì‹œ ë°˜ì˜ë˜ì–´ Mixed Content ë“± ì´ì „ ì½”ë“œë¡œ ì¸í•œ ë¬¸ì œê°€ í•´ê²°ë©ë‹ˆë‹¤.

# CloudFront ìºì‹œ ë¬´íš¨í™”
aws cloudfront create-invalidation \
  --distribution-id E2CEDBBNSXCSGZ \
  --paths "/*"