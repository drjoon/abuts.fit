# abuts.fit ALB 미사용(간단 배포) 실무 명령어 및 설정 예시

## 1. S3 정적 웹사이트 호스팅 및 퍼블릭 액세스/정책/CORS

```bash
# S3 버킷 생성 및 웹사이트 호스팅 활성화
aws s3api create-bucket \
  --bucket abuts.fit \
  --region ap-south-1 \
  --create-bucket-configuration LocationConstraint=ap-south-1

aws s3 website s3://abuts.fit/ --index-document index.html --error-document index.html

# 퍼블릭 액세스 차단 해제
aws s3api put-public-access-block \
  --bucket abuts.fit \
  --public-access-block-configuration 'BlockPublicAcls=false,IgnorePublicAcls=false,BlockPublicPolicy=false,RestrictPublicBuckets=false'

# 버킷 정책 적용 (예시)
aws s3api put-bucket-policy --bucket abuts.fit --policy '{
  "Version":"2012-10-17",
  "Statement":[{
    "Sid":"PublicReadGetObject",
    "Effect":"Allow",
    "Principal": "*",
    "Action":["s3:GetObject"],
    "Resource":["arn:aws:s3:::abuts.fit/*"]
  }]
}'

# CORS 설정 적용
aws s3api put-bucket-cors --bucket abuts.fit --cors-configuration file://doc/cors.json

# 정적 파일 업로드 및 CloudFront 캐시 무효화
npm run build
aws s3 sync ./dist s3://abuts.fit --region ap-south-1
aws cloudfront create-invalidation \
  --distribution-id [CloudFront-배포ID] \
  --paths "/*"
```

---

## 2. Route 53 도메인 연결 상세

```bash
# Hosted Zone 생성 및 NS 레코드 확인
aws route53 list-hosted-zones-by-name --dns-name abuts.fit
aws route53 create-hosted-zone --name abuts.fit --caller-reference $(date +%s)

# NS 레코드 등록 후, S3 Website Endpoint로 A 레코드(Alias) 등록
# change-batch.json 예시
{
  "Comment": "S3 website alias",
  "Changes": [
    {
      "Action": "UPSERT",
      "ResourceRecordSet": {
        "Name": "abuts.fit",
        "Type": "A",
        "AliasTarget": {
          "HostedZoneId": "Z11RGJOFQNVJUP",
          "DNSName": "s3-website.ap-south-1.amazonaws.com.",
          "EvaluateTargetHealth": false
        }
      }
    }
  ]
}

# 레코드 등록
aws route53 change-resource-record-sets --hosted-zone-id [HostedZoneId] --change-batch file://doc/change-batch.json

# DNS 캐시 갱신/확인
sudo killall -HUP mDNSResponder
nslookup abuts.fit
dig abuts.fit
```

---
